<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>test2</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
button {
    position: absolute;
    margin: 20px;
}

#pause::after {
    content: 'Pause';
}

#pause.pause::after {
    content: 'Play';
}
</style>
<div id='map'></div>
<button id='pause'></button>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic3RlcGhlbmxpMzA1IiwiYSI6ImNqbncyaWR0ZzFsc2MzcW1rNWczbnVqeDYifQ.afmueMPaXRJ1f4XXcG0IgA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v10',
    center: [-122.271111, 37.804363],
    zoom: 5
});

// Create a GeoJSON source with an empty lineString.
var geojson = {
    "type": "FeatureCollection",
    "features": [{
        "type": "Feature",
        "geometry": {
            "type": "LineString",
            "coordinates": [
                // [-122.271111, 37.804363]
                // [-118.2437, 34.0522]
                // [,]
            ]
        }
    }]
};
// var lageojson = {
//     "type": "FeatureCollection",
//     "features": [{
//         "type": "Feature",
//         "geometry": {
//             "type": "LineString",
//             "coordinates": [
//                 [118.2437, 34.0522]
//             ]
//         }
//     }]
// };

// var speedFactor = 30; // number of frames per longitude degree
var animation; // to store and cancel the animation
// var startTime = 0;
// var timeInSeconds = 0; // timeInSeconds = timestamp - startTime
var percentDone = 0; // timeInSeconds = timestamp - startTime
var resetTime = false; // indicator of whether time reset is needed for the animation
var pauseButton = document.getElementById('pause');

map.on('load', function() {

    // add the line which will be modified in the animation
    map.addLayer({
        'id': 'line-animation',
        'type': 'line',
        'source': {
            'type': 'geojson',
            'data': geojson
        },
        'layout': {
            'line-cap': 'round',
            'line-join': 'round'
        },
        'paint': {
            'line-color': '#FDB927',
            'line-width': 5,
            'line-opacity': .8
        }
    });

    startTime = performance.now();

    animateLine();

    // click the button to pause or play
    pauseButton.addEventListener('click', function() {
        pauseButton.classList.toggle('pause');
        if (pauseButton.classList.contains('pause')) {
          cancelAnimationFrame(animation);
        } else {
          resetTime = true;
          animateLine();
        }
    });

    // reset startTime and timeInSeconds once the tab loses or gains focus
    // requestAnimationFrame also pauses on hidden tabs by default
    document.addEventListener('visibilitychange', function() {
        resetTime = true;
    });

    function animateLine(timestamp) {
        if (resetTime) {
        //     // resume previous timeInSeconds
            timeInSeconds = (timestamp - startTime) / 1000;
            resetTime = false;
        } else
         {
            timeInSeconds = (timestamp - startTime) / 1000;
            percentDone = timeInSeconds / 1
        }

        // restart if it finishes a loop
        if (timeInSeconds < 1)
        // {
        //     startTime = timestamp;
        //     geojson.features[0].geometry.coordinates ;
        // } else
        {
            var startx = -122.271111
            var endx = -118.2437

            var starty = 37.804363
            var endy = 34.0522

            // var startz = 36.1699
            // var endz = -115.1398

            var x = startx + (endx - startx) * percentDone
            var y = starty + (endy - starty) * percentDone
            console.log(performance.now());
            // console.log(startTime);
            console.log(timestamp);
            // console.log(percentDone);
            // console.log(timeInSeconds);
            // var z = startz + (endz - startz) * percentDone


            // var y = 37.804363 / percentDone
            // var x = geojson.feature[0].geometry.coordinates[0] - lageojson.feature[0].geometry.coordinates[0];
            // var y = geojson.feature[0].geometry.coordinates[1] - lageojson.feature[0].geometry.coordinates[1];
            // draw a sine wave with some math.
            // console.log(x);
            // console.log(y);
            // console.log(timestamp / 1000);
            // append new coordinates to the lineString
            geojson.features[0].geometry.coordinates.push([x, y])
            // console.log(geojson.features[0].geometry.coordinates.push([x, y]))
            // geojson.features[0].geometry.coordinates.push([y,z])

            // then update the map
              map.getSource('line-animation').setData(geojson)
            // console.log(geojson.features[0].geometry.coordinates.push([x, y]))
            // console.log(geojson)
            // console.log(map.getSource('line-animation').setData(geojson));
        }
        // Request the next frame of the animation.
        animation = requestAnimationFrame(animateLine);
    }


});
</script>

</body>
</html>
